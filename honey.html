<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc t·∫≠p h√¥m nay üìö</title>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .date-display {
            color: #666;
            font-size: 1.2em;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .subject-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
        }

        .subject-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .subject-card.completed {
            opacity: 0.7;
            background: #f0f0f0;
        }

        .subject-card.completed::after {
            content: '‚úì';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4caf50;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }

        .subject-card.in-progress {
            border: 3px solid #ff9800;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4); }
            50% { box-shadow: 0 5px 25px rgba(255, 152, 0, 0.8); }
        }

        .subject-card.class-type {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }

        .time-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .subject-name {
            font-size: 1.5em;
            color: #333;
            margin: 10px 0;
            font-weight: bold;
        }

        .subject-type {
            color: #999;
            font-size: 0.9em;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2em;
            cursor: pointer;
            color: #999;
            background: none;
            border: none;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn:hover {
            background: #5568d3;
            transform: scale(1.05);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #4caf50;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        /* Mode selection styles */
        .mode-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .mode-card {
            border: 3px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-card:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .mode-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .mode-card .icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .mode-card .title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .mode-card .description {
            font-size: 0.9em;
            color: #666;
        }

        /* Exam mode styles */
        .exam-mode-screen {
            background: #000;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .exam-mode-screen.active {
            display: flex;
        }

        .exam-timer {
            font-size: 8em;
            color: #fff;
            font-weight: bold;
            margin-bottom: 30px;
            font-family: 'Courier New', monospace;
        }

        .exam-timer.warning {
            color: #ff9800;
            animation: blink 1s infinite;
        }

        .exam-timer.danger {
            color: #f44336;
        }

        .exam-subject {
            font-size: 2em;
            color: #aaa;
            margin-bottom: 50px;
        }

        .exam-finish-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 20px 50px;
            border-radius: 15px;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s;
display: none;
        }

        .exam-finish-btn:hover {
            background: #45a049;
            transform: scale(1.1);
        }

        .timer-display {
            font-size: 3em;
            text-align: center;
            color: #667eea;
            margin: 20px 0;
            font-weight: bold;
        }

        .timer-display.warning {
            color: #ff9800;
            animation: blink 1s infinite;
        }

        .timer-display.danger {
            color: #f44336;
        }

        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.5; }
        }

        .question-tracker {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .question-item {
            aspect-ratio: 1;
            border: 2px solid #ddd;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .question-item:hover {
            transform: scale(1.1);
        }

        .question-item.completed {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .chat-popup {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 400px;
            height: 600px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 2000;
            flex-direction: column;
        }

        .chat-popup.active {
            display: flex;
        }

        .chat-header {
            background: #667eea;
            color: white;
            padding: 15px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .prompt-box {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .copy-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .break-activities {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .activity-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .activity-card:hover {
            transform: scale(1.05);
        }

        .activity-card .icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stats-summary {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .reward-display {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5em;
            margin: 20px 0;
        }

        .encouragement {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.1em;
            text-align: center;
            font-weight: bold;
        }

        .alert-banner {
            background: #ff5252;
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
            align-items: center;
            gap: 15px;
            animation: shake 0.5s;
        }

        .alert-banner.active {
            display: flex;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .chat-popup {
                width: 90%;
                right: 5%;
            }
            
            .modal-content {
                padding: 20px;
            }

            .exam-timer {
                font-size: 4em;
            }

            .mode-selection {
                grid-template-columns: 1fr;
            }
.submit-guide {
    background: linear-gradient(135deg, #fff3cd 0%, #ffe8a1 100%);
    border-left: 5px solid #ffc107;
    padding: 20px;
    margin: 20px 0;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.submit-guide h3 {
    color: #856404;
    margin-bottom: 15px;
    font-size: 1.3em;
}

.submit-guide ol {
    color: #856404;
    line-height: 2;
    margin-left: 20px;
    font-size: 1em;
}

.submit-guide ol li {
    margin: 8px 0;
    padding-left: 5px;
}

.submit-guide ol li strong {
    color: #d9534f;
}

.submit-warning {
    background: #f8d7da;
    color: #721c24;
    padding: 12px;
    border-radius: 8px;
    margin-top: 15px;
    text-align: center;
    font-weight: bold;
    border: 2px solid #f5c6cb;
}

.timer-warning {
    animation: pulse-warning 2s infinite;
}

@keyframes pulse-warning {
    0%, 100% { 
        background: #fff3cd;
        transform: scale(1);
    }
    50% { 
        background: #ffe8a1;
        transform: scale(1.02);
    }
}
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Xin ch√†o! üëã</h1>
            <div class="date-display" id="dateDisplay"></div>
        </div>

        <div class="alert-banner" id="alertBanner">
            <span style="font-size: 2em;">‚ö†Ô∏è</span>
            <span id="alertMessage"></span>
        </div>

        <div id="scheduleContainer" class="schedule-grid"></div>
    </div>

    <!-- Modal for Class Type -->
    <div class="modal" id="classModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('classModal')">&times;</button>
            <h2 style="color: #667eea; margin-bottom: 20px;">üìö Ti·∫øt h·ªçc t·∫°i l·ªõp</h2>
            <div id="classInfo"></div>
            <button class="btn btn-success" onclick="markClassComplete()">‚úì ƒê√£ ho√†n th√†nh</button>
        </div>
    </div>

    <!-- Modal for Homework Setup -->
    <div class="modal" id="setupModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('setupModal')">&times;</button>
            <h2 style="color: #667eea; margin-bottom: 20px;">Chu·∫©n b·ªã l√†m b√†i</h2>
            <div id="setupForm"></div>
        </div>
    </div>

    <!-- Modal for Working (Normal Mode) -->
    <div class="modal" id="workModal">
        <div class="modal-content">
            <h2 style="color: #667eea; margin-bottom: 20px;" id="workTitle"></h2>
            <div class="timer-display" id="timerDisplay">00:00</div>
            <div class="question-tracker" id="questionTracker"></div>
            <div class="action-buttons">
                <button class="btn" onclick="openChatAI()">üí¨ Chat AI</button>
                <button class="btn btn-secondary" onclick="callParent('m·∫π')">üìû G·ªçi m·∫π</button>
                <button class="btn btn-secondary" onclick="callParent('b·ªë')">üìû G·ªçi b·ªë</button>
            </div>
            <button class="btn btn-success" onclick="finishWork()" style="width: 100%; margin-top: 20px;">Ho√†n th√†nh</button>
        </div>
    </div>

    <!-- Exam Mode Screen -->
    <div class="exam-mode-screen" id="examModeScreen">
        <div class="exam-subject" id="examSubject"></div>
        <div class="exam-timer" id="examTimer">00:00</div>
        <button class="exam-finish-btn" onclick="finishWork()">Ho√†n th√†nh</button>
    </div>

    <!-- Modal for Results -->
    <div class="modal" id="resultModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeResultModal()">&times;</button>
            <h2 style="color: #667eea; margin-bottom: 20px;">üéâ K·∫øt qu·∫£ l√†m b√†i</h2>
            <div id="resultContent"></div>
        </div>
    </div>

    <!-- Modal for Break -->
    <div class="modal" id="breakModal">
        <div class="modal-content">
            <h2 style="color: #667eea; margin-bottom: 20px;">‚òï Ngh·ªâ gi·∫£i lao</h2>
            <div class="timer-display" id="breakTimer">05:00</div>
            <p style="text-align: center; color: #666; margin-bottom: 20px;">Ch·ªçn ho·∫°t ƒë·ªông gi·∫£i tr√≠:</p>
            <div class="break-activities">
                <div class="activity-card" onclick="selectActivity('Nh·∫£y theo nh·∫°c')">
                    <div class="icon">üíÉ</div>
                    <div>Nh·∫£y theo nh·∫°c</div>
                </div>
                <div class="activity-card" onclick="selectActivity('Ch·∫°y c·∫ßu thang')">
                    <div class="icon">üèÉ</div>
                    <div>Ch·∫°y c·∫ßu thang</div>
                </div>
                <div class="activity-card" onclick="selectActivity('B√¥i kem cho b√†')">
                    <div class="icon">ü§ó</div>
                    <div>B√¥i kem cho b√†</div>
                </div>
                <div class="activity-card" onclick="selectActivity('U·ªëng n∆∞·ªõc')">
                    <div class="icon">üíß</div>
                    <div>U·ªëng n∆∞·ªõc</div>
                </div>
            </div>
            <button class="btn btn-secondary" onclick="skipBreak()" style="width: 100%; margin-top: 20px;">B·ªè qua ngh·ªâ</button>
        </div>
    </div>

    <!-- Chat Popup -->
    <div class="chat-popup" id="chatPopup">
        <div class="chat-header">
            <span>üí¨ Chat v·ªõi Claude AI</span>
            <button class="close-btn" onclick="closeChatAI()" style="position: static; color: white;">&times;</button>
        </div>
        <div class="chat-body">
            <p style="margin-bottom: 15px; color: #666;">Sao ch√©p prompt b√™n d∆∞·ªõi v√† d√°n v√†o Claude.ai:</p>
            <div class="prompt-box" id="promptBox"></div>
            <button class="copy-btn" onclick="copyPrompt()">üìã Sao ch√©p</button>
            <button class="btn" onclick="openClaudeAI()" style="width: 100%; margin-top: 15px;">M·ªü Claude.ai</button>
        </div>
    </div>

    <audio id="alarmSound" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuCzvLZizUHGGS56eObTA0PPKXh8bllHAU2jdXvx3YpBSh+zPDajzsIFmm98OScTQ0PN6Xh8bllHAU2jdXvx3YpBSh+zPDajzsIFmm98OScTQ0PN6Xh8bllHAU2jdXvx3YpBSh+zPDajzsIFmm98OScTQ0PN6Xh8bllHAU2jdXvx3YpBSh+zPDajzsIFmm98OScTQ0PN6Xh8bllHAU2jdXvx3YpBSh+zPDajzsIFmm98OScTQ0PN6Xh8bllHAU2jdXvx3YpBSh+zPDajzsIFmm98OScTQ0PN6Xh8bllHAU2jdXvx3YpBSh+zPDajzsIFmm98OScTQ0PN6Xh8bllHAU2jdXvx3YpBSh+zPDajzsIFmm98OScTQ0PN6Xh8bllHAU2jdXvx3YpBSh+zPDajzsIFmm98OScTQ0PN6Xh8bllHAU2jdXvx3YpBSh+zPDajzsIFmm98OScTQ0PN6Xh8bllHAU2jdXvx3YpBSh+zPDajzsIFmm98OScTQ0P" preload="auto"></audio>

    <script>
        // Schedule data
        const SCHEDULE = {
            'Monday': [
                {time: '16h30-17h15', subject: 'Y√™n H√≤a HW', type: 'homework', requireSubmit: true},
                {time: '17h20-19h00', subject: 'Maths c√¥ H·∫£i', type: 'homework', requireSubmit: true},
                {time: '19h30-20h00', subject: 'Eat + Shower', type: 'break', requireSubmit: false},
                {time: '20h-21h30', subject: 'FCE online', type: 'homework', requireSubmit: true},
                {time: '21h30-22h', subject: 'Y√™n H√≤a HW', type: 'homework', requireSubmit: true}
            ],
            'Tuesday': [
                {time: '16h30-17h30', subject: 'Y√™n H√≤a HW + FCE extra speaking', type: 'homework', requireSubmit: true},
                {time: '17h30-18h', subject: 'Eat', type: 'break', requireSubmit: false},
                {time: '18h-20h', subject: 'Speaking Class (LIME)', type: 'class', requireSubmit: false, note: 'Nh·ªõ mang s√°ch v√† v·ªü'},
                {time: '20h30-21h30', subject: 'Go home + Shower', type: 'break', requireSubmit: false},
                {time: '21h30-22h', subject: 'FCE online HW / ch·ªØa b√†i sai', type: 'homework', requireSubmit: true}
            ],
            'Wednesday': [
                {time: '17h-18h', subject: 'Y√™n H√≤a HW + FCE extra speaking', type: 'homework', requireSubmit: true},
                {time: '18h-19h', subject: 'Eat + Shower', type: 'break', requireSubmit: false},
                {time: '19h-20h30', subject: 'Maths c√¥ H·∫£i HW (2.5h)', type: 'homework', requireSubmit: true},
                {time: '20h35-21h35', subject: 'FCE offline HW / ch·ªØa b√†i sai', type: 'homework', requireSubmit: true},
                {time: '21h30-22h', subject: 'FCE Speaking HW / extra', type: 'homework', requireSubmit: true}
            ],
            'Thursday': [
                {time: '17h-18h', subject: 'Y√™n H√≤a HW + FCE extra speaking', type: 'homework', requireSubmit: true},
                {time: '18h-19h', subject: 'Eat + Shower', type: 'break', requireSubmit: false},
                {time: '19h-19h45', subject: 'FCE offline HW / ch·ªØa b√†i sai', type: 'homework', requireSubmit: true},
                {time: '20h-21h', subject: 'FCE Online Class', type: 'class', requireSubmit: false, note: 'Nh·ªõ mang s√°ch FCE'},
                {time: '21h35-22h', subject: 'FCE offline HW / ch·ªØa b√†i sai', type: 'homework', requireSubmit: true}
            ],
            'Friday': [
                {time: '16h30-17h30', subject: 'Math HW c√¥ H·∫£i', type: 'homework', requireSubmit: true},
                {time: '17h30-18h', subject: 'Eat', type: 'break', requireSubmit: false},
                {time: '18h-20h30', subject: 'FCE Offline Class', type: 'class', requireSubmit: false, note: 'Nh·ªõ mang s√°ch FCE'},
                {time: '21h30-22h', subject: 'Shower + Free time', type: 'break', requireSubmit: false}
            ],
            'Saturday': [
                {time: '9h-12h', subject: 'Math HW c√¥ H·∫£i', type: 'homework', requireSubmit: true},
                {time: '12h-14h30', subject: 'FCE online HW / ch·ªØa b√†i sai', type: 'homework', requireSubmit: true},
                {time: '12h20-14h30', subject: 'Eat + Sleep', type: 'break', requireSubmit: false},
                {time: '14h40-15h40', subject: 'FCE online HW / ch·ªØa b√†i sai', type: 'homework', requireSubmit: true},
                {time: '15h45-16h45', subject: 'FCE Speaking HW', type: 'homework', requireSubmit: true},
                {time: '16h50-19h', subject: 'Kick boxing', type: 'class', requireSubmit: false, note: 'Mang ƒë·ªì t·∫≠p'},
                {time: '17h35-18h15', subject: 'Chu·∫©n b·ªã b√†i Speaking Club', type: 'homework', requireSubmit: false},
                {time: '19h-21h', subject: 'Speech Class', type: 'class', requireSubmit: false},
                {time: '21h-22h', subject: 'Shower + Free time', type: 'break', requireSubmit: false}
            ],
            'Sunday': [
                {time: '7h15', subject: 'Wake up', type: 'break', requireSubmit: false},
                {time: '8h-8h15', subject: 'Eat breakfast', type: 'break', requireSubmit: false},
                {time: '9h-10h', subject: 'Ukulele', type: 'homework', requireSubmit: false},
                {time: '10h30-11h30', subject: 'Speaking Club', type: 'class', requireSubmit: false},
                {time: '12h-13h30', subject: 'Math c√¥ H·∫£i', type: 'homework', requireSubmit: true},
                {time: '13h30-15h', subject: 'Eat + Sleep', type: 'break', requireSubmit: false},
                {time: '15h-16h', subject: 'FCE HW (c·∫£ l·ªõp onl v√† l·ªõp Off) Ch·ªØa v√† Ho√†n th√†nh b√†i m·ªõi', type: 'homework', requireSubmit: true},
                {time: '16-17h', subject: 'FCE HW (c·∫£ l·ªõp onl v√† l·ªõp Off) Ch·ªØa v√† Ho√†n th√†nh b√†i m·ªõi', type: 'homework', requireSubmit: true},
                {time: '17h05-18h', subject: 'Eat + Shower', type: 'break', requireSubmit: false},
                {time: '18h-19h', subject: 'Y√™n H√≤a HW', type: 'homework', requireSubmit: true},
                {time: '19h-20h', subject: 'Y√™n H√≤a HW', type: 'homework', requireSubmit: true},
                {time: '20h05-21h', subject: 'Ch·ªØa b√†i c√°c m√¥n To√°n / ho√†n th√†nh BTVN c√°c m√¥n To√°n', type: 'homework', requireSubmit: true},
                {time: '21h-22h', subject: 'ƒê√¢u tr∆∞·ªùng Gia ƒê√¨nh', type: 'break', requireSubmit: false}
            ]
        };

        // Form templates
        const FORM_TEMPLATES = {
            'FCE Reading': {parts: 7, questions: [8,6,6,7,6,6,10]},
            'FCE Writing': {parts: 2, questions: [1,1]},
            'FCE Listening': {parts: 4, questions: [8,10,5,7]},
            'FCE Speaking': {parts: 4, questions: [1,1,1,1]},
            'To√°n c√¥ H·∫£i - Ch·ªØa ƒë·ªÅ': {parts: 1, questions: [15]}
        };

        // Prompts for AI
        const AI_PROMPTS = {
            'To√°n': `Ch√†o Claude! Em ƒëang l√†m b√†i to√°n l·ªõp 8 v√† g·∫∑p kh√≥ khƒÉn. Em s·∫Ω ch·ª•p/m√¥ t·∫£ ƒë·ªÅ b√†i.
B·∫°n h√£y:
1. ƒê·ªçc k·ªπ ƒë·ªÅ b√†i v√† x√°c nh·∫≠n em hi·ªÉu ƒë·ªÅ ƒë√∫ng ch∆∞a
2. G·ª£i √Ω h∆∞·ªõng gi·∫£i (KH√îNG gi·∫£i lu√¥n), ƒë·∫∑t c√¢u h·ªèi g·ª£i m·ªü ƒë·ªÉ em t·ª± suy nghƒ©
3. N·∫øu em v·∫´n ch∆∞a ra, h√£y gi·∫£i th√≠ch t·ª´ng b∆∞·ªõc nh·ªè, d·ª´ng l·∫°i ƒë·ªÉ em l√†m ti·∫øp
4. Khuy·∫øn kh√≠ch em t·ª± l√†m, ch·ªâ h∆∞·ªõng d·∫´n khi th·ª±c s·ª± c·∫ßn
H√£y ki√™n nh·∫´n v√† ƒë·ªông vi√™n em nh√©!`,

            'FCE Reading': `Ch√†o Claude! Em ƒëang luy·ªán FCE Reading v√† c√≥ c√¢u kh√≥. Em s·∫Ω ch·ª•p ƒëo·∫°n vƒÉn v√† c√¢u h·ªèi.
B·∫°n h√£y:
1. Gi·∫£i th√≠ch t·ª´ v·ª±ng kh√≥ (n·∫øu c√≥) b·∫±ng ti·∫øng Vi·ªát ƒë∆°n gi·∫£n
2. Ph√¢n t√≠ch c·∫•u tr√∫c c√¢u ph·ª©c t·∫°p
3. Ch·ªâ ra keywords trong c√¢u h·ªèi v√† ƒëo·∫°n vƒÉn
4. H∆∞·ªõng d·∫´n k·ªπ thu·∫≠t l√†m d·∫°ng b√†i n√†y
5. G·ª¢I √ù ƒë√°p √°n (kh√¥ng n√≥i th·∫≥ng), ƒë·ªÉ em t·ª± ch·ªçn
M·ª•c ti√™u c·ªßa em l√† ƒë·∫°t C1 (180 ƒëi·ªÉm) nh√©!`,

            'FCE Writing': `Ch√†o Claude! Em c·∫ßn feedback cho b√†i FCE Writing.
Y√™u c·∫ßu ƒë·ªÅ b√†i: [em s·∫Ω paste]
B√†i l√†m c·ªßa em: [em s·∫Ω paste/ch·ª•p]

B·∫°n h√£y ƒë√°nh gi√° theo 4 ti√™u ch√≠ FCE:
1. Content (C√≥ ƒë·ªß √Ω? C√≥ tr·∫£ l·ªùi ƒë√∫ng y√™u c·∫ßu kh√¥ng?)
2. Communicative Achievement (Phong c√°ch, gi·ªçng vƒÉn ph√π h·ª£p?)
3. Organisation (B·ªë c·ª•c r√µ r√†ng? Linking words?)
4. Language (Ng·ªØ ph√°p, t·ª´ v·ª±ng ƒëa d·∫°ng? Sai s√≥t?)

Cho ƒëi·ªÉm d·ª± ki·∫øn (A2/B1/B2/C1) v√† G·ª¢I √ù C·∫¢I THI·ªÜN C·ª§ TH·ªÇ ƒë·ªÉ l√™n C1.
Kh√¥ng vi·∫øt l·∫°i to√†n b·ªô b√†i gi√∫p em, ch·ªâ s·ª≠a 2-3 c√¢u m·∫´u th√¥i nh√©!`,

            'FCE Listening': `Ch√†o Claude! Em ƒëang luy·ªán FCE Listening v√† c·∫ßn gi·∫£i th√≠ch.
Em s·∫Ω m√¥ t·∫£ c√¢u h·ªèi v√† nh·ªØng g√¨ em nghe ƒë∆∞·ª£c.

B·∫°n h√£y:
1. Gi·∫£i th√≠ch t·ª´ v·ª±ng/c·ª•m t·ª´ kh√≥ trong audio
2. Ph√¢n t√≠ch t·∫°i sao ƒë√°p √°n ƒë√∫ng l√† ... (n·∫øu em bi·∫øt ƒë√°p √°n)
3. H∆∞·ªõng d·∫´n k·ªπ thu·∫≠t nghe ƒë·ªÉ b·∫Øt ƒë∆∞·ª£c th√¥ng tin
4. G·ª£i √Ω c√°ch c·∫£i thi·ªán Listening ƒë·ªÉ ƒë·∫°t C1

M·ª•c ti√™u: C1 (180 ƒëi·ªÉm)`,

            'FCE Speaking': `Ch√†o Claude! Em mu·ªën luy·ªán FCE Speaking.
Part [1/2/3/4]: [em m√¥ t·∫£]

B·∫°n ƒë√≥ng vai examiner:
1. ƒê∆∞a c√¢u h·ªèi theo format FCE
2. Sau khi em tr·∫£ l·ªùi, cho feedback ng·∫Øn v·ªÅ:
   - Fluency (tr√¥i ch·∫£y?)
   - Grammar & Vocabulary (ƒëa d·∫°ng?)
   - Pronunciation tips (qua text, g·ª£i √Ω ph√°t √¢m chu·∫©n)
3. G·ª£i √Ω c√°ch tr·∫£ l·ªùi t·ªët h∆°n ƒë·ªÉ ƒë·∫°t C1
4. Ti·∫øp t·ª•c c√¢u h·ªèi kh√°c

H√£y nghi√™m kh·∫Øc nh∆∞ng ƒë·ªông vi√™n em nh√©!`,

            'Y√™n H√≤a': `Ch√†o Claude! Em ƒëang l√†m b√†i t·∫≠p Y√™n H√≤a v√† c·∫ßn tr·ª£ gi√∫p.
Em s·∫Ω ch·ª•p/m√¥ t·∫£ ƒë·ªÅ b√†i.

B·∫°n h√£y:
1. ƒê·ªçc k·ªπ ƒë·ªÅ v√† x√°c nh·∫≠n em hi·ªÉu ƒë√∫ng ch∆∞a
2. G·ª£i √Ω h∆∞·ªõng l√†m (kh√¥ng gi·∫£i lu√¥n)
3. Gi·∫£i th√≠ch c√°c kh√°i ni·ªám n·∫øu em ch∆∞a r√µ
4. Khuy·∫øn kh√≠ch em t·ª± l√†m

H√£y ki√™n nh·∫´n v·ªõi em nh√©!`
        };

        // Global state
        let currentSession = null;
        let timerInterval = null;
        let breakTimerInterval = null;
        let workStartTime = null;
        let completedSubjects = [];
        let breakWarningTimeout = null;

        // Initialize
        window.onload = function() {
            displayDate();
            loadSchedule();
            loadProgress();
        };

        function displayDate() {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const daysVi = ['Ch·ªß nh·∫≠t', 'Th·ª© hai', 'Th·ª© ba', 'Th·ª© t∆∞', 'Th·ª© nƒÉm', 'Th·ª© s√°u', 'Th·ª© b·∫£y'];
            const today = new Date();
            const dayName = days[today.getDay()];
            const dayNameVi = daysVi[today.getDay()];
            const dateStr = today.toLocaleDateString('vi-VN');
            
            document.getElementById('dateDisplay').textContent = `${dayNameVi}, ${dateStr}`;
            
            return dayName;
        }

        function loadSchedule() {
            const dayName = displayDate();
            const todaySchedule = SCHEDULE[dayName] || [];
            const container = document.getElementById('scheduleContainer');
            container.innerHTML = '';

            todaySchedule.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'subject-card';
                
                if (item.type === 'class') {
                    card.className += ' class-type';
                }
                
                if (completedSubjects.includes(index)) {
                    card.className += ' completed';
                }
                
                if (currentSession && currentSession.index === index) {
                    card.className += ' in-progress';
                }

                let typeLabel = '';
                if (item.type === 'homework') typeLabel = 'üìù B√†i t·∫≠p v·ªÅ nh√†';
                else if (item.type === 'class') typeLabel = 'üè´ H·ªçc t·∫°i l·ªõp';
                else if (item.type === 'break') typeLabel = '‚òï Ngh·ªâ ng∆°i';

                card.innerHTML = `
                    <div class="time-badge">${item.time}</div>
                    <div class="subject-name">${item.subject}</div>
                    <div class="subject-type">${typeLabel}</div>
                `;

                card.onclick = () => handleSubjectClick(item, index);
                container.appendChild(card);
            });
        }

        function handleSubjectClick(subject, index) {
            if (completedSubjects.includes(index)) {
                alert('M√¥n n√†y ƒë√£ ho√†n th√†nh r·ªìi! üéâ');
                return;
            }

            if (subject.type === 'break') {
                alert('ƒê√¢y l√† th·ªùi gian ngh·ªâ ng∆°i. H√£y th∆∞ gi√£n nh√©! üòä');
                return;
            }

            if (subject.type === 'class') {
                showClassModal(subject, index);
            } else if (subject.type === 'homework') {
                showSetupModal(subject, index);
            }
        }

        function showClassModal(subject, index) {
            const modal = document.getElementById('classModal');
            const info = document.getElementById('classInfo');
            
            info.innerHTML = `
                <p style="font-size: 1.3em; margin: 20px 0;"><strong>${subject.subject}</strong></p>
                <p style="font-size: 1.1em; color: #666; margin: 15px 0;">‚è∞ ${subject.time}</p>
                <p style="font-size: 1em; color: #ff9800; margin: 15px 0;">üìù ${subject.note || 'Nh·ªõ mang ƒë·∫ßy ƒë·ªß ƒë·ªì d√πng h·ªçc t·∫≠p'}</p>
            `;
            
            modal.classList.add('active');
            currentSession = {index, subject, type: 'class'};
        }

        function markClassComplete() {
            if (currentSession) {
                completedSubjects.push(currentSession.index);
                saveProgress();
                closeModal('classModal');
                loadSchedule();
                logActivity('Ho√†n th√†nh m√¥n h·ªçc t·∫°i l·ªõp', currentSession.subject.subject);
            }
        }

        function showSetupModal(subject, index) {
            const modal = document.getElementById('setupModal');
            const form = document.getElementById('setupForm');
            
            let formHTML = `
                <div class="input-group">
                    <label>M√¥n h·ªçc:</label>
                    <input type="text" value="${subject.subject}" disabled>
                </div>

                <div class="input-group">
                    <label>Ch·∫ø ƒë·ªô l√†m b√†i:</label>
                    <div class="mode-selection">
                        <div class="mode-card selected" onclick="selectMode('normal')" id="modeNormal">
                            <div class="icon">üìù</div>
                            <div class="title">L√†m b√†i th∆∞·ªùng</div>
                            <div class="description">C√≥ h·ªó tr·ª£ Chat AI, g·ªçi b·ªë m·∫π, theo d√µi c√¢u h·ªèi</div>
                        </div>
                        <div class="mode-card" onclick="selectMode('exam')" id="modeExam">
                            <div class="icon">üéØ</div>
                            <div class="title">Ch·∫ø ƒë·ªô luy·ªán thi</div>
                            <div class="description">M√†n h√¨nh ƒëen, ch·ªâ c√≥ ƒë·ªìng h·ªì, t·∫≠p trung cao ƒë·ªô nh∆∞ thi th·∫≠t</div>
                        </div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Ch·ªçn d·∫°ng b√†i:</label>
                    <select id="formTemplate" onchange="updateFormTemplate()">
                        <option value="">T·ª± nh·∫≠p s·ªë c√¢u</option>
            `;
            
            for (let template in FORM_TEMPLATES) {
                if (subject.subject.includes('FCE') && template.includes('FCE') ||
                    subject.subject.includes('To√°n') && template.includes('To√°n') ||
                    subject.subject.includes('Math') && template.includes('To√°n')) {
                    formHTML += `<option value="${template}">${template}</option>`;
                }
            }
            
            formHTML += `
                    </select>
                </div>
                <div class="input-group" id="customInputs">
                    <label>S·ªë ph·∫ßn (parts):</label>
                    <input type="number" id="numParts" value="1" min="1">
                    <label style="margin-top: 10px;">S·ªë c√¢u m·ªói ph·∫ßn (c√°ch nhau b·ªüi d·∫•u ph·∫©y):</label>
                    <input type="text" id="numQuestions" placeholder="VD: 10,15,20" value="10">
                </div>
                <div class="input-group">
                    <label>Th·ªùi gian d·ª± ki·∫øn (ph√∫t):</label>
                    <input type="number" id="targetTime" value="30" min="1">
                    <p style="font-size: 0.9em; color: #666; margin-top: 5px;" id="aiSuggestion"></p>
                </div>
                <button class="btn btn-success" onclick="startWork()">B·∫Øt ƒë·∫ßu l√†m b√†i</button>
            `;
            
            form.innerHTML = formHTML;
            modal.classList.add('active');
            currentSession = {index, subject, type: 'homework', mode: 'normal'};
            
            // AI suggestion for time
            suggestTime(subject.subject);
        }

        function selectMode(mode) {
            currentSession.mode = mode;
            document.getElementById('modeNormal').classList.toggle('selected', mode === 'normal');
            document.getElementById('modeExam').classList.toggle('selected', mode === 'exam');
        }

        function updateFormTemplate() {
            const template = document.getElementById('formTemplate').value;
            if (template && FORM_TEMPLATES[template]) {
                const data = FORM_TEMPLATES[template];
                document.getElementById('numParts').value = data.parts;
                document.getElementById('numQuestions').value = data.questions.join(',');
            }
        }

        function suggestTime(subject) {
            const suggestions = {
                'FCE Reading': 45,
                'FCE Writing': 40,
                'FCE Listening': 30,
                'FCE Speaking': 20,
                'To√°n': 45,
                'Math': 45,
                'Y√™n H√≤a': 30
            };
            
            let suggested = 30;
            for (let key in suggestions) {
                if (subject.includes(key)) {
                    suggested = suggestions[key];
                    break;
                }
            }
            
            document.getElementById('targetTime').value = suggested;
            document.getElementById('aiSuggestion').textContent = `üí° G·ª£i √Ω: ${suggested} ph√∫t d·ª±a tr√™n k·∫øt qu·∫£ t·ªët nh·∫•t c·ªßa b√©`;
        }

        function startWork() {
            const numParts = parseInt(document.getElementById('numParts').value);
            const questionsStr = document.getElementById('numQuestions').value;
            const targetTime = parseInt(document.getElementById('targetTime').value);
            
            const questions = questionsStr.split(',').map(q => parseInt(q.trim()));
            if (questions.length !== numParts) {
                alert('S·ªë c√¢u kh√¥ng kh·ªõp v·ªõi s·ªë ph·∫ßn!');
                return;
            }
            
            currentSession.numParts = numParts;
            currentSession.questions = questions;
            currentSession.targetTime = targetTime * 60; // convert to seconds
            currentSession.completedQuestions = [];
            currentSession.startTime = Date.now();
            currentSession.callParentLogs = [];
            
            closeModal('setupModal');
            
            if (currentSession.mode === 'exam') {
                showExamMode();
            } else {
                showWorkModal();
            }
        }

        function showExamMode() {
            const screen = document.getElementById('examModeScreen');
            const subjectEl = document.getElementById('examSubject');
            
            subjectEl.textContent = currentSession.subject.subject;
timerEl.style.display = 'none'; // ·∫®n ƒë·ªìng h·ªì ban ƒë·∫ßu
            screen.classList.add('active');
            
            workStartTime = Date.now();
            timerInterval = setInterval(updateExamTimer, 1000);
            
            logActivity('B·∫Øt ƒë·∫ßu luy·ªán thi', currentSession.subject.subject);
        }

        function updateExamTimer() {
    const elapsed = Math.floor((Date.now() - workStartTime) / 1000);
    const minutes = Math.floor(elapsed / 60);
    const seconds = elapsed % 60;
    const timeLeft = currentSession.targetTime - elapsed;
    
    const display = document.getElementById('examTimer');
    const finishBtn = document.querySelector('.exam-finish-btn');
    
    // Hi·ªán ƒë·ªìng h·ªì khi c√≤n 15 ph√∫t (900 gi√¢y)
    if (timeLeft <= 900 && timeLeft > 0) {
        display.style.display = 'block';
        display.textContent = `${String(Math.floor(timeLeft / 60)).padStart(2, '0')}:${String(timeLeft % 60).padStart(2, '0')}`;
        display.classList.remove('warning', 'danger'); // Kh√¥ng nh·∫•p nh√°y
    }
    
    // H·∫øt gi·ªù
   // H·∫øt gi·ªù
if (elapsed >= currentSession.targetTime) {
    clearInterval(timerInterval);
    playAlarm();
    display.textContent = '00:00';
    display.style.display = 'block';
    
    // Hi·ªán h∆∞·ªõng d·∫´n n·ªôp b√†i
    const subjectEl = document.getElementById('examSubject');
    subjectEl.innerHTML = `
        <div style="background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
            <div style="font-size: 1.5em; color: #ffc107; margin-bottom: 15px;">‚è∞ H·∫æT GI·ªú L√ÄM B√ÄI!</div>
            <div style="font-size: 1em; color: #fff; text-align: left; line-height: 1.8;">
                <strong style="color: #4caf50;">üìã 5 ph√∫t ƒë·ªÉ n·ªôp b√†i:</strong><br>
                1Ô∏è‚É£ Ch·ª•p/Scan b√†i ‚Üí T·∫°o PDF<br>
                2Ô∏è‚É£ G·ª≠i Zalo ‚Üí T·∫£i v·ªÅ m√°y t√≠nh<br>
                3Ô∏è‚É£ B·∫•m n√∫t "N·ªôp b√†i" b√™n d∆∞·ªõi<br>
            </div>
        </div>
    `;
    
    finishBtn.textContent = 'üì§ N·ªôp b√†i (5 ph√∫t)';
    finishBtn.style.display = 'block';
        
        // B·∫Øt ƒë·∫ßu ƒë·∫øm ng∆∞·ª£c 5 ph√∫t cho scan & upload
        currentSession.uploadStartTime = Date.now();
        currentSession.uploadTimeLimit = 300; // 5 ph√∫t = 300 gi√¢y
        timerInterval = setInterval(updateUploadTimer, 1000);
        
        logActivity('‚è∞ H·∫øt gi·ªù l√†m b√†i', currentSession.subject.subject);
    }
}

function updateUploadTimer() {
    const elapsed = Math.floor((Date.now() - currentSession.uploadStartTime) / 1000);
    const timeLeft = currentSession.uploadTimeLimit - elapsed;
    
    const display = document.getElementById('examTimer');
    const finishBtn = document.querySelector('.exam-finish-btn');
    
    if (timeLeft > 0) {
        display.textContent = `C√≤n ${Math.floor(timeLeft / 60)}:${String(timeLeft % 60).padStart(2, '0')} ƒë·ªÉ n·ªôp`;
    } else {
        clearInterval(timerInterval);
        display.textContent = 'H·∫øt gi·ªù n·ªôp b√†i!';
        finishBtn.textContent = '‚úÖ Ho√†n th√†nh (kh√¥ng n·ªôp)';
    }
}

        function showWorkModal() {
            const modal = document.getElementById('workModal');
            const title = document.getElementById('workTitle');
            const tracker = document.getElementById('questionTracker');
            
            title.textContent = currentSession.subject.subject;
            
            // Create question tracker
            tracker.innerHTML = '';
            let questionNum = 1;
            for (let i = 0; i < currentSession.numParts; i++) {
                for (let j = 0; j < currentSession.questions[i]; j++) {
                    const qItem = document.createElement('div');
                    qItem.className = 'question-item';
                    qItem.textContent = questionNum;
                    qItem.onclick = () => toggleQuestion(questionNum - 1, qItem);
                    tracker.appendChild(qItem);
                    questionNum++;
                }
            }
            
            modal.classList.add('active');
            startTimer();
        }

        function toggleQuestion(index, element) {
            if (currentSession.completedQuestions.includes(index)) {
                currentSession.completedQuestions = currentSession.completedQuestions.filter(q => q !== index);
                element.classList.remove('completed');
            } else {
                currentSession.completedQuestions.push(index);
                element.classList.add('completed');
                
                if (Math.random() > 0.7) {
                    showEncouragement();
                }
            }
        }

        function showEncouragement() {
            const messages = [
                'üí™ L√†m t·ªët l·∫Øm!',
                'üåü Xu·∫•t s·∫Øc!',
                'üéØ Ch√≠nh x√°c!',
                'üöÄ Ti·∫øp t·ª•c nh√©!',
                '‚≠ê Gi·ªèi qu√°!',
                'üéâ Tuy·ªát v·ªùi!'
            ];
            
            const msg = messages[Math.floor(Math.random() * messages.length)];
            showAlert(msg, 2000);
        }

        function startTimer() {
            workStartTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - workStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            const display = document.getElementById('timerDisplay');
            display.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            if (elapsed > currentSession.targetTime) {
                display.classList.add('danger');
                
                if ((elapsed - currentSession.targetTime) % 300 === 0 && (elapsed - currentSession.targetTime) > 0) {
                    showOvertimeAlert(elapsed - currentSession.targetTime);
                }
            } else if (elapsed > currentSession.targetTime * 0.8) {
                display.classList.add('warning');
            }
        }

        function showOvertimeAlert(overtime) {
            const minutes = Math.floor(overtime / 60);
            showAlert(`‚ö†Ô∏è Con ƒë√£ l√†m qu√° ${minutes} ph√∫t so v·ªõi d·ª± ki·∫øn. Con c√≥ c·∫ßn tr·ª£ gi√∫p kh√¥ng?`, 10000);
            
            logActivity('C·∫£nh b√°o l√†m b√†i qu√° l√¢u', `Qu√° ${minutes} ph√∫t - ${currentSession.subject.subject}`);
        }

       // T√¨m v√† THAY TH·∫æ h√†m openChatAI() trong honey.html (d√≤ng ~960)
function openChatAI() {
    const popup = document.getElementById('chatPopup');
    const promptBox = document.getElementById('promptBox');
    
    let prompt = '';
    const subjectName = currentSession.subject.subject;
    
    if (subjectName.includes('To√°n') || subjectName.includes('Math')) {
        prompt = AI_PROMPTS['To√°n'];
    } else if (subjectName.includes('FCE Reading')) {
        prompt = AI_PROMPTS['FCE Reading'];
    } else if (subjectName.includes('FCE Writing')) {
        prompt = AI_PROMPTS['FCE Writing'];
    } else if (subjectName.includes('FCE Listening')) {
        prompt = AI_PROMPTS['FCE Listening'];
    } else if (subjectName.includes('FCE Speaking')) {
        prompt = AI_PROMPTS['FCE Speaking'];
    } else if (subjectName.includes('Y√™n H√≤a')) {
        prompt = AI_PROMPTS['Y√™n H√≤a'];
    } else {
        prompt = `Ch√†o Claude! Em ƒëang l√†m b√†i ${subjectName} v√† c·∫ßn tr·ª£ gi√∫p. Em s·∫Ω m√¥ t·∫£ ƒë·ªÅ b√†i. H√£y gi√∫p em nh√©!`;
    }
    
    promptBox.textContent = prompt;
    popup.classList.add('active');
    
    // ‚úÖ GHI LOG ƒê√öNG C√ÅCH ƒë·ªÉ ƒë·∫øm ƒë∆∞·ª£c
    logActivity('M·ªü chat AI', subjectName);
}

        function closeChatAI() {
            document.getElementById('chatPopup').classList.remove('active');
        }

        function copyPrompt() {
            const prompt = document.getElementById('promptBox').textContent;
            navigator.clipboard.writeText(prompt).then(() => {
                alert('‚úÖ ƒê√£ sao ch√©p! H√£y d√°n v√†o Claude.ai nh√©!');
            });
        }

        function openClaudeAI() {
            window.open('https://claude.ai', '_blank');
        }

        function callParent(who) {
            const time = new Date().toLocaleTimeString('vi-VN');
            currentSession.callParentLogs.push({who, time});
            logActivity(`G·ªçi ${who}`, `${currentSession.subject.subject} - ${time}`);
            alert(`üìû ƒê√£ ghi nh·∫≠n: G·ªçi ${who} l√∫c ${time}`);
        }

        function finishWork() {
            clearInterval(timerInterval);
            
            const totalTime = Math.floor((Date.now() - workStartTime) / 1000);
            const totalQuestions = currentSession.questions.reduce((a, b) => a + b, 0);
            const completed = currentSession.mode === 'exam' ? totalQuestions : currentSession.completedQuestions.length;
            
            currentSession.totalTime = totalTime;
            currentSession.completionRate = (completed / totalQuestions * 100).toFixed(1);
            
            if (currentSession.mode === 'exam') {
                document.getElementById('examModeScreen').classList.remove('active');
            } else {
                closeModal('workModal');
            }
            
            showResultModal();
        }

        function showResultModal() {
            const modal = document.getElementById('resultModal');
            const content = document.getElementById('resultContent');
            
            const totalTime = currentSession.totalTime;
            const targetTime = currentSession.targetTime;
            const totalQuestions = currentSession.questions.reduce((a, b) => a + b, 0);
            const completed = currentSession.mode === 'exam' ? totalQuestions : currentSession.completedQuestions.length;
            const avgTime = (totalTime / completed).toFixed(1);
            
            const minutesUsed = Math.floor(totalTime / 60);
            const secondsUsed = totalTime % 60;
            const minutesTarget = Math.floor(targetTime / 60);
            
            let reward = 0;
            let rewardReason = [];
            
            if (totalTime <= targetTime) {
                reward += 2000;
                rewardReason.push('Ho√†n th√†nh ƒë√∫ng th·ªùi gian: +2,000ƒë');
            }
            
            if (totalTime <= targetTime * 0.8) {
                reward += 1000;
                rewardReason.push('L√†m nhanh h∆°n 20%: +1,000ƒë');
            }
            
            if (completed === totalQuestions) {
                reward += 2000;
                rewardReason.push('Ho√†n th√†nh 100%: +2,000ƒë');
            } else if (completed >= totalQuestions * 0.9) {
                reward += 1000;
                rewardReason.push('Ho√†n th√†nh 90%+: +1,000ƒë');
            }
            
            if (currentSession.mode === 'exam') {
                reward += 1000;
                rewardReason.push('Ch·∫ø ƒë·ªô luy·ªán thi (bonus): +1,000ƒë');
            }
            
            currentSession.reward = reward;
            
            let encouragement = '';
            if (completed === totalQuestions && totalTime <= targetTime) {
                encouragement = 'üåü Xu·∫•t s·∫Øc! Con ƒë√£ l√†m b√†i r·∫•t t·ªët!';
            } else if (completed >= totalQuestions * 0.8) {
                encouragement = 'üí™ T·ªët l·∫Øm! Con ƒëang ti·∫øn b·ªô!';
            } else {
                encouragement = 'üéØ Con c·ªë g·∫Øng nh√©! L·∫ßn sau s·∫Ω t·ªët h∆°n!';
            }
            
            let slowWarning = '';
            if (currentSession.mode !== 'exam' && avgTime > 3) {
                slowWarning = `<div class="encouragement" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">
                    ‚ö†Ô∏è Con l√†m trung b√¨nh m·ªói c√¢u m·∫•t ${avgTime} ph√∫t. 
                    ${currentSession.callParentLogs.length === 0 ? 'Con ƒë√£ th·ª≠ d√πng Chat AI ch∆∞a nh·ªâ?' : ''}
                    H√£y t·∫≠p trung h∆°n v√† s·ª≠ d·ª•ng c√¥ng c·ª• h·ªó tr·ª£ khi c·∫ßn nh√©!
                </div>`;
            }
            
            content.innerHTML = `
                <div class="stats-summary">
                    <div class="stat-row">
                        <span><strong>Ch·∫ø ƒë·ªô:</strong></span>
                        <span>${currentSession.mode === 'exam' ? 'üéØ Luy·ªán thi' : 'üìù L√†m b√†i th∆∞·ªùng'}</span>
                    </div>
                    <div class="stat-row">
                        <span><strong>Th·ªùi gian l√†m b√†i:</strong></span>
                        <span>${minutesUsed} ph√∫t ${secondsUsed} gi√¢y</span>
                    </div>
                    <div class="stat-row">
                        <span><strong>M·ª•c ti√™u:</strong></span>
                        <span>${minutesTarget} ph√∫t</span>
                    </div>
                    <div class="stat-row">
                        <span><strong>Ho√†n th√†nh:</strong></span>
                        <span>${completed}/${totalQuestions} c√¢u (${currentSession.completionRate}%)</span>
                    </div>
                    <div class="stat-row">
                        <span><strong>Trung b√¨nh m·ªói c√¢u:</strong></span>
                        <span>${avgTime} ph√∫t</span>
                    </div>
                    ${currentSession.mode !== 'exam' ? `<div class="stat-row">
                        <span><strong>S·ªë l·∫ßn g·ªçi b·ªë m·∫π:</strong></span>
                        <span>${currentSession.callParentLogs.length} l·∫ßn</span>
                    </div>` : ''}
                </div>
                
                <div class="encouragement">${encouragement}</div>
                ${slowWarning}
                
                <div class="reward-display">
                    üí∞ Ti·ªÅn th∆∞·ªüng: ${reward.toLocaleString('vi-VN')}ƒë
                </div>
                
                <div style="background: #f5f5f5; padding: 15px; border-radius: 10px; margin: 15px 0;">
                    <strong>Chi ti·∫øt th∆∞·ªüng:</strong>
                    ${rewardReason.map(r => `<div style="margin: 5px 0;">‚úì ${r}</div>`).join('')}
                </div>
                
                <p style="text-align: center; color: #666; margin: 20px 0;">
                    ${currentSession.subject.requireSubmit ? 'B·∫°n c√≥ mu·ªën n·ªôp b√†i ƒë·ªÉ ch·∫•m kh√¥ng?' : 'B√†i n√†y kh√¥ng c·∫ßn n·ªôp'}
                </p>
               ${currentSession.subject.requireSubmit ? `
    <div class="submit-guide">
        <h3>üìã H∆∞·ªõng d·∫´n n·ªôp b√†i (5 ph√∫t):</h3>
        <ol>
            <li><strong>B∆∞·ªõc 1:</strong> Ch·ª•p/Scan t·∫•t c·∫£ c√°c trang b√†i l√†m b·∫±ng ƒëi·ªán tho·∫°i</li>
            <li><strong>B∆∞·ªõc 2:</strong> T·∫°o file PDF (d√πng CamScanner ho·∫∑c t√≠nh nƒÉng scan c·ªßa ƒëi·ªán tho·∫°i)</li>
            <li><strong>B∆∞·ªõc 3:</strong> G·ª≠i file PDF l√™n Zalo (g·ª≠i cho ch√≠nh m√¨nh ho·∫∑c nh√≥m)</li>
            <li><strong>B∆∞·ªõc 4:</strong> M·ªü Zalo tr√™n m√°y t√≠nh ‚Üí T·∫£i file PDF xu·ªëng</li>
            <li><strong>B∆∞·ªõc 5:</strong> B·∫•m n√∫t "üì§ N·ªôp b√†i" ‚Üí Ch·ªçn file PDF v·ª´a t·∫£i</li>
        </ol>
        <div class="submit-warning timer-warning">
            ‚è∞ Con c√≥ 5 ph√∫t ƒë·ªÉ ho√†n th√†nh! H√£y nhanh tay nh√©!
        </div>
    </div>
    <button class="btn btn-success" onclick="submitWork()">üì§ N·ªôp b√†i ƒë·ªÉ ch·∫•m</button>
` : '<p style="text-align: center; color: #666; margin: 20px 0;">B√†i n√†y kh√¥ng c·∫ßn n·ªôp</p>'}
<button class="btn btn-secondary" onclick="skipSubmit()">B·ªè qua</button>
            `;
            
            modal.classList.add('active');
        }

        async function submitWork() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'application/pdf,image/*';
    input.multiple = true;
    
    input.onchange = async function(e) {
        const files = Array.from(e.target.files);
        if (files.length === 0) {
            alert('‚ùå Ch∆∞a ch·ªçn file n√†o!');
            return;
        }
        
        showLoading('üì§ ƒêang upload b√†i l√†m l√™n Drive...');
        
        try {
            // Upload t·ª´ng file
            const uploadResults = [];
            
            for (let file of files) {
                // Convert to base64
                const fileBase64 = await fileToBase64(file);
                
               // G·ªçi Google Apps Script
const uploadResponse = await fetch(APPS_SCRIPT_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        action: 'upload',
        fileName: file.name,
        fileBase64: fileBase64.split(',')[1],
        subject: currentSession.subject.subject,
        sessionDate: new Date().toISOString()
    })
});
                
                const uploadData = await uploadResponse.json();
                
                if (!uploadData.success) {
                    throw new Error(`Upload failed: ${uploadData.error}`);
                }
                
                uploadResults.push({
                    fileName: file.name,
                    fileId: uploadData.fileId,
                    driveUrl: uploadData.driveUrl,
                    fileBase64: fileBase64.split(',')[1] // L∆∞u ƒë·ªÉ ch·∫•m b√†i
                });
            }
            
            hideLoading();
            
            // L∆∞u th√¥ng tin v√†o session
            currentSession.submittedFiles = uploadResults;
            
            // H·ªèi c√≥ mu·ªën ch·∫•m ngay kh√¥ng
            const wantGrade = confirm(
                `‚úÖ ƒê√£ upload ${files.length} file l√™n Drive!\n\n` +
                `üîó Xem t·∫°i: ${uploadResults[0].driveUrl}\n\n` +
                `ü§ñ B·∫°n c√≥ mu·ªën AI ch·∫•m b√†i ngay kh√¥ng?`
            );
            
            if (wantGrade) {
                await gradeAssignment(uploadResults[0].fileId, uploadResults[0].fileBase64);
            } else {
                alert('üìù B√†i l√†m ƒë√£ ƒë∆∞·ª£c l∆∞u. M·∫π s·∫Ω ch·∫•m sau nh√©!');
                skipSubmit();
            }
            
        } catch (error) {
            hideLoading();
            console.error('Upload error:', error);
            alert('‚ùå L·ªói khi upload: ' + error.message);
        }
    };
    
    input.click();
}

// Ch·∫•m b√†i v·ªõi Groq
async function gradeAssignment(fileId, fileBase64) {
    showLoading('ü§ñ AI ƒëang ch·∫•m b√†i... (10-30 gi√¢y)');
    
    try {
        const totalQuestions = currentSession.questions.reduce((a, b) => a + b, 0);
        
        const gradeResponse = await fetch(APPS_SCRIPT_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        action: 'grade',
        submissionId: fileId,
        fileBase64: fileBase64,
        subject: currentSession.subject.subject,
        totalQuestions: totalQuestions
    })
});
        
        const gradeData = await gradeResponse.json();
        
        if (!gradeData.success) {
            throw new Error(gradeData.error);
        }
        
        hideLoading();
        
        // Hi·ªÉn th·ªã k·∫øt qu·∫£
        showGradingResult(gradeData.result);
        
    } catch (error) {
        hideLoading();
        console.error('Grading error:', error);
        alert('‚ùå L·ªói khi ch·∫•m b√†i: ' + error.message + '\n\nM·∫π s·∫Ω ch·∫•m th·ªß c√¥ng nh√©!');
        skipSubmit();
    }
}

// Hi·ªÉn th·ªã k·∫øt qu·∫£ ch·∫•m
function showGradingResult(result) {
    const modal = document.getElementById('resultModal');
    const content = document.getElementById('resultContent');
    
    const isMath = currentSession.subject.subject.includes('To√°n') || 
                   currentSession.subject.subject.includes('Math');
    
    let detailHTML = '';
    
    if (isMath) {
        // Hi·ªÉn th·ªã k·∫øt qu·∫£ To√°n
        detailHTML = `
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 20px; text-align: center;">
                <div style="font-size: 3em; font-weight: bold;">${result.totalScore}/${result.maxScore}</div>
                <div style="font-size: 1.2em; margin-top: 10px;">ƒêi·ªÉm: ${result.percentage}%</div>
            </div>
            
            <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #667eea; margin-bottom: 15px;">üìù Chi ti·∫øt t·ª´ng c√¢u:</h3>
                ${result.questions.map(q => `
                    <div style="background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 5px solid ${q.answerCorrect ? '#4caf50' : '#ff5252'};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <strong>C√¢u ${q.number}</strong>
                            <span style="background: ${q.answerCorrect ? '#4caf50' : '#ff5252'}; color: white; padding: 3px 10px; border-radius: 5px;">
                                ${q.score}/${q.maxScore} ƒëi·ªÉm
                            </span>
                        </div>
                        <p style="color: #666; margin-top: 10px;">${q.feedback}</p>
                    </div>
                `).join('')}
            </div>
        `;
    } else {
        // Hi·ªÉn th·ªã k·∫øt qu·∫£ FCE
        detailHTML = `
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 20px; text-align: center;">
                <div style="font-size: 2.5em; font-weight: bold;">${result.cefrLevel}</div>
                <div style="font-size: 1.2em; margin-top: 10px;">${result.totalScore}/${result.maxScore} ƒëi·ªÉm</div>
                <div style="font-size: 1em; margin-top: 5px; opacity: 0.9;">Target: ${result.targetLevel}</div>
            </div>
            
            <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #667eea; margin-bottom: 15px;">üìä Ti√™u ch√≠ ch·∫•m:</h3>
                ${Object.entries(result.criteria).map(([key, value]) => `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="text-transform: capitalize;">${key}</span>
                            <strong>${value}/5</strong>
                        </div>
                        <div style="background: #e0e0e0; height: 10px; border-radius: 5px; overflow: hidden;">
                            <div style="background: #667eea; height: 100%; width: ${value * 20}%;"></div>
                        </div>
                    </div>
                `).join('')}
            </div>
            
            ${result.specificFeedback && result.specificFeedback.length > 0 ? `
            <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #856404; margin-bottom: 15px;">‚úèÔ∏è L·ªói c·∫ßn s·ª≠a:</h3>
                ${result.specificFeedback.map(fb => `
                    <div style="padding: 10px; background: white; border-radius: 5px; margin-bottom: 10px;">
                        ${fb}
                    </div>
                `).join('')}
            </div>
            ` : ''}
        `;
    }
    
    // ƒêi·ªÉm m·∫°nh & c·∫ßn c·∫£i thi·ªán
    detailHTML += `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
            <div style="background: #e8f5e9; padding: 20px; border-radius: 10px;">
                <h3 style="color: #2e7d32; margin-bottom: 10px;">üí™ ƒêi·ªÉm m·∫°nh:</h3>
                <ul style="margin-left: 20px;">
                    ${result.strengths.map(s => `<li style="margin: 5px 0;">${s}</li>`).join('')}
                </ul>
            </div>
            <div style="background: #fff3e0; padding: 20px; border-radius: 10px;">
                <h3 style="color: #e65100; margin-bottom: 10px;">üìà C·∫ßn c·∫£i thi·ªán:</h3>
                <ul style="margin-left: 20px;">
                    ${result.improvements.map(i => `<li style="margin: 5px 0;">${i}</li>`).join('')}
                </ul>
            </div>
        </div>
        
        <div class="encouragement" style="margin-bottom: 20px;">
            ${result.overall}
        </div>
        
        <button class="btn btn-success" onclick="closeResultModalAndContinue()" style="width: 100%;">Ti·∫øp t·ª•c h·ªçc</button>
    `;
    
    content.innerHTML = `
        <h2 style="color: #667eea; margin-bottom: 20px;">ü§ñ K·∫øt qu·∫£ ch·∫•m b√†i AI</h2>
        ${detailHTML}
    `;
    
    modal.classList.add('active');
}

// Helper: Close modal v√† ti·∫øp t·ª•c
function closeResultModalAndContinue() {
    closeModal('resultModal');
    skipSubmit();
}

// Helper functions
function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
}

function showLoading(message) {
    let overlay = document.getElementById('loadingOverlay');
    if (!overlay) {
        overlay = document.createElement('div');
        overlay.id = 'loadingOverlay';
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
        `;
        document.body.appendChild(overlay);
    }
    
    overlay.innerHTML = `
        <div style="font-size: 3em; margin-bottom: 20px; animation: spin 1s linear infinite;">‚è≥</div>
        <div style="font-size: 1.5em; text-align: center; padding: 0 20px;">${message}</div>
    `;
    overlay.style.display = 'flex';
}

function hideLoading() {
    const overlay = document.getElementById('loadingOverlay');
    if (overlay) {
        overlay.style.display = 'none';
    }
}



        function skipSubmit() {
    completedSubjects.push(currentSession.index);
    saveProgress();
    closeModal('resultModal');
    loadSchedule();
    
    saveSessionData();
    
    // N·∫øu l√† ch·∫ø ƒë·ªô thi th√¨ ngh·ªâ 10 ph√∫t, kh√¥ng th√¨ 5 ph√∫t
    const breakTime = currentSession.mode === 'exam' ? 10 : 5;
    showBreakModal(breakTime);
}

        function closeResultModal() {
            closeModal('resultModal');
            completedSubjects.push(currentSession.index);
            saveProgress();
            loadSchedule();
            showBreakModal();
        }

        function showBreakModal(breakMinutes = 5) {
    const modal = document.getElementById('breakModal');
    const title = modal.querySelector('h2');
    title.textContent = `‚òï Ngh·ªâ gi·∫£i lao (${breakMinutes} ph√∫t)`;
    modal.classList.add('active');
    startBreakTimer(breakMinutes * 60);
}

function startBreakTimer(seconds) {
    let timeLeft = seconds;
    const display = document.getElementById('breakTimer');
    display.textContent = `${String(Math.floor(timeLeft / 60)).padStart(2, '0')}:${String(timeLeft % 60).padStart(2, '0')}`;
    
    breakTimerInterval = setInterval(() => {
        timeLeft--;
        const minutes = Math.floor(timeLeft / 60);
        const secs = timeLeft % 60;
        display.textContent = `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        
        if (timeLeft <= 0) {
            clearInterval(breakTimerInterval);
            playAlarm();
            alert('‚è∞ H·∫øt gi·ªù ngh·ªâ r·ªìi! Chu·∫©n b·ªã h·ªçc ti·∫øp nh√©! üí™');
            skipBreak();
        }
    }, 1000);
            
            breakWarningTimeout = setTimeout(() => {
                logActivity('‚ö†Ô∏è C·∫¢NH B√ÅO', 'ƒê√£ qu√° 7 ph√∫t ngh·ªâ gi·∫£i lao, ch∆∞a th·∫•y con ho·∫°t ƒë·ªông');
            }, 420000); // 7 minutes
        }

        function playAlarm() {
            const audio = document.getElementById('alarmSound');
            audio.play().catch(e => console.log('Cannot play alarm:', e));
        }

        function selectActivity(activity) {
            logActivity('Ho·∫°t ƒë·ªông gi·∫£i lao', activity);
            alert(`Tuy·ªát! H√£y ${activity.toLowerCase()} nh√©! üòä`);
        }

        function skipBreak() {
            clearInterval(breakTimerInterval);
            clearTimeout(breakWarningTimeout);
            closeModal('breakModal');
            currentSession = null;
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showAlert(message, duration = 5000) {
            const banner = document.getElementById('alertBanner');
            const messageEl = document.getElementById('alertMessage');
            messageEl.textContent = message;
            banner.classList.add('active');
            
            setTimeout(() => {
                banner.classList.remove('active');
            }, duration);
        }

        function saveProgress() {
            localStorage.setItem('completedSubjects', JSON.stringify(completedSubjects));
        }

        function loadProgress() {
            const saved = localStorage.getItem('completedSubjects');
            if (saved) {
                completedSubjects = JSON.parse(saved);
            }
            
            const lastReset = localStorage.getItem('lastReset');
            const today = new Date().toDateString();
            if (lastReset !== today) {
                completedSubjects = [];
                localStorage.setItem('lastReset', today);
                localStorage.setItem('completedSubjects', JSON.stringify([]));
            }
        }

        // T√¨m v√† THAY TH·∫æ h√†m saveSessionData() trong honey.html (d√≤ng ~1180)
function saveSessionData() {
    // T√≠nh s·ªë l·∫ßn d√πng Chat AI t·ª´ activity logs
    let aiChatCount = 0;
    const logs = JSON.parse(localStorage.getItem('activityLogs') || '[]');
    logs.forEach(log => {
        if (log.type === 'M·ªü chat AI' && log.detail.includes(currentSession.subject.subject)) {
            aiChatCount++;
        }
    });

    // T·∫°o danh s√°ch c√¢u h·ªèi t·ª´ tracking
    const totalQuestions = currentSession.questions.reduce((a, b) => a + b, 0);
    const questionsList = [];
    for (let i = 0; i < totalQuestions; i++) {
        questionsList.push({
            completed: currentSession.mode === 'exam' ? true : currentSession.completedQuestions.includes(i),
            timeSpent: currentSession.mode === 'exam' ? Math.floor(currentSession.totalTime / totalQuestions) : null
        });
    }

    // T·∫°o feedback t·ª± ƒë·ªông
    let feedback = '';
    if (currentSession.completionRate >= 100 && currentSession.totalTime <= currentSession.targetTime) {
        feedback = 'üåü Xu·∫•t s·∫Øc! Con ƒë√£ ho√†n th√†nh ƒë√∫ng gi·ªù v√† ƒë·∫ßy ƒë·ªß!';
    } else if (currentSession.completionRate >= 90) {
        feedback = 'üí™ R·∫•t t·ªët! Con ƒëang ti·∫øn b·ªô ƒë·ªÅu ƒë·∫∑n!';
    } else if (currentSession.totalTime > currentSession.targetTime * 1.5) {
        feedback = '‚ö†Ô∏è Con l√†m ch·∫≠m h∆°n d·ª± ki·∫øn. H√£y t·∫≠p trung h∆°n ho·∫∑c h·ªèi b·ªë m·∫π nh√©!';
    } else {
        feedback = 'üëç C·ªë g·∫Øng l√™n! L·∫ßn sau s·∫Ω t·ªët h∆°n!';
    }

    const sessionData = {
        id: 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9), // T·∫°o ID duy nh·∫•t
        date: new Date().toISOString(),
        subject: currentSession.subject.subject,
        mode: currentSession.mode,
        time: currentSession.totalTime,
        targetTime: currentSession.targetTime,
        completionRate: currentSession.completionRate,
        reward: currentSession.reward,
        
        // ‚úÖ TH√äM c√°c tr∆∞·ªùng c√≤n thi·∫øu
        questions: questionsList,
        aiChatCount: aiChatCount,
        callParentCount: currentSession.callParentLogs ? currentSession.callParentLogs.length : 0,
        callParentLogs: currentSession.callParentLogs || [],
        feedback: feedback,
        
        // Th√™m ƒëi·ªÉm s·ªë n·∫øu c√≥ n·ªôp b√†i
        score: currentSession.submittedFiles ? undefined : undefined, // S·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t khi ch·∫•m
        total: totalQuestions,
        
        // Th√™m tr·∫°ng th√°i th∆∞·ªüng
        paid: false,
        paidDate: null,
        
        // Th√™m th√¥ng tin n·ªôp b√†i
        submittedFiles: currentSession.submittedFiles || null
    };
    
    let history = JSON.parse(localStorage.getItem('sessionHistory') || '[]');
    history.push(sessionData);
    localStorage.setItem('sessionHistory', JSON.stringify(history));
    
    console.log('‚úÖ Session saved with full data:', sessionData);
}
// FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyBv5qOVgNajnOKoz-vaIYENSWZY2jB8N30",
  authDomain: "honey-4d9b1.firebaseapp.com",
  projectId: "honey-4d9b1",
  storageBucket: "honey-4d9b1.firebasestorage.app",
  messagingSenderId: "108470975596",
  appId: "1:108470975596:web:c3223c55e7afbd9276ac49"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// URL c·ªßa Google Apps Script
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyQgklJRPBeMHRX6x0gyBjEgx_UAMqWLD-OPu39c0pLbVkr7XeFa5RdfyrzH6mhtcXKYg/exec'; // S·∫Ω c√≥ sau khi deploy Apps Script

        function logActivity(type, detail) {
            const log = {
                timestamp: new Date().toISOString(),
                type: type,
                detail: detail
            };
            
            let logs = JSON.parse(localStorage.getItem('activityLogs') || '[]');
            logs.push(log);
            localStorage.setItem('activityLogs', JSON.stringify(logs));
            
            console.log('Activity logged:', log);
        }
 const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);

    </script>
</body>
</html>